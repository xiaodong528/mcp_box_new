# MCP Box + Memo 离线部署 - 快速开始

## 📂 文件位置

所有离线部署相关文件已整合到 `demos/Memo` 目录：

```
demos/Memo/
├── docs/                              # 📚 部署文档
│   ├── README.md                      # 文档中心导航
│   ├── offline-deployment-quickstart.md  # 快速入门指南
│   └── offline-deployment.md          # 完整部署文档
│
├── scripts/                           # 🛠️ 部署脚本
│   ├── 01-build-package.sh           # 外网打包脚本
│   ├── 02-deploy-offline.sh          # 内网部署脚本
│   ├── 03-health-check.sh            # 健康检查脚本
│   ├── 04-backup-data.sh             # 数据备份脚本
│   ├── docker-start.sh               # Docker 启动脚本
│   └── docker-stop.sh                # Docker 停止脚本
│
├── backend/                           # Memo 后端代码
├── frontend/                          # Memo 前端代码
├── docker-compose.yml                 # Docker Compose 配置
├── Dockerfile                         # Memo 镜像构建文件
├── docker-entrypoint.sh               # 容器入口脚本
└── requirements.txt                   # Python 依赖
```

---

## 🚀 三步完成离线部署

### 第一步：外网环境 - 准备离线包

```bash
# 进入 Memo 目录
cd /path/to/mcp_box_new/demos/Memo

# 运行打包脚本
bash scripts/01-build-package.sh

# 产物：项目根目录下的 mcp-box-offline-YYYYMMDD.tar.gz (约 1-1.5 GB)
```

### 第二步：传输到内网

```bash
# 上传离线包到内网服务器
scp /path/to/mcp_box_new/mcp-box-offline-YYYYMMDD.tar.gz user@internal-server:/opt/
```

### 第三步：内网环境 - 一键部署

```bash
# 解压离线包
cd /opt && mkdir mcp-box-deploy
tar -xzf mcp-box-offline-YYYYMMDD.tar.gz -C mcp-box-deploy
cd mcp-box-deploy

# 配置环境变量
cp config/.env.template .env
vim .env  # 修改 E2B_JUPYTER_HOST, E2B_API_KEY 等

# 一键部署
bash scripts/02-deploy-offline.sh

# 验证服务
bash scripts/03-health-check.sh
```

---

## ✅ 验证部署成功

访问以下地址验证服务：

| 服务 | 地址 | 预期响应 |
|------|------|----------|
| Memo API | http://localhost:48000/health | `{"status":"healthy"}` |
| Memo 前端 | http://localhost:48002 | 备忘录页面 |
| MCP Box SSE | http://localhost:47070/sse | SSE 事件流 |

---

## 📖 详细文档

- **快速入门**: [docs/offline-deployment-quickstart.md](docs/offline-deployment-quickstart.md)
- **完整文档**: [docs/offline-deployment.md](docs/offline-deployment.md)
- **文档中心**: [docs/README.md](docs/README.md)

---

## 🔧 常用命令

```bash
# 查看服务状态
docker compose ps

# 查看服务日志
docker compose logs -f

# 重启服务
docker compose restart

# 健康检查
bash scripts/03-health-check.sh

# 数据备份
bash scripts/04-backup-data.sh
```

---

## ⚠️ 注意事项

1. **环境要求**:
   - Docker >= 20.10
   - Docker Compose >= 2.0
   - 磁盘空间 >= 5 GB

2. **必填配置** (.env 文件):
   - `E2B_JUPYTER_HOST` - E2B 沙箱服务地址
   - `E2B_API_KEY` - E2B API 密钥
   - `STORE_IN_FILE=true` - 推荐使用文件存储模式

3. **端口占用检查**:
   ```bash
   netstat -tuln | grep -E '47070|47071|48000|48001|48002'
   # 确保这些端口未被占用
   ```

---

## 📞 遇到问题？

查看详细的故障排查指南：
- [快速入门 - 故障排查](docs/offline-deployment-quickstart.md#-故障排查)
- [完整文档 - 故障排查](docs/offline-deployment.md#四故障排查)

**祝部署顺利! 🎉**
